<!DOCTYPE html>

<html>
<head>
  <title>humanize.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>humanize.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Shortcuts for native object methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>objectRef = <span class="keyword">new</span> -&gt;
toString = objectRef.toString</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Helper methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="function"><span class="title">isNaN</span></span> = (value) -&gt; value <span class="keyword">isnt</span> value

<span class="function"><span class="title">isFinite</span></span> = (value) -&gt; (window?.isFinite <span class="keyword">or</span> global.isFinite)(value) <span class="keyword">and</span> <span class="keyword">not</span> isNaN(parseFloat(value))

<span class="function"><span class="title">isArray</span></span> = (value) -&gt; toString.call(value) <span class="keyword">is</span> <span class="string">'[object Array]'</span>

timeFormats = [
    {
        name: <span class="string">'second'</span>
        value: <span class="number">1e3</span>
    }, {
        name: <span class="string">'minute'</span>
        value: <span class="number">6e4</span>
    }, {
        name: <span class="string">'hour'</span>
        value: <span class="number">36e5</span>
    }, {
        name: <span class="string">'day'</span>
        value: <span class="number">864e5</span>
    }, {
        name: <span class="string">'week'</span>
        value: <span class="number">6048e5</span>
    }
]

Humanize = {}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Converts a large integer to a friendly text representation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">intword</span></span> = (number, charWidth, decimals=<span class="number">2</span>) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h1>#</h1>
<p>This method is deprecated. Please use compactInteger instead.
intword will be going away in the next major version.</p>
<h1>#</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Humanize.compactInteger(number, decimals)</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>converts an integer into its most compact representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">compactInteger</span></span> = (input, decimals=<span class="number">0</span>) -&gt;
    decimals             = Math.max decimals, <span class="number">0</span>
    number               = parseInt input, <span class="number">10</span>
    signString           = <span class="keyword">if</span> number &lt; <span class="number">0</span> <span class="keyword">then</span> <span class="string">"-"</span> <span class="keyword">else</span> <span class="string">""</span>
    unsignedNumber       = Math.abs number
    unsignedNumberString = <span class="string">""</span> + unsignedNumber
    numberLength         = unsignedNumberString.length
    numberLengths        = [ <span class="number">13</span> ,  <span class="number">10</span>,  <span class="number">7</span>,   <span class="number">4</span> ]
    bigNumPrefixes       = [ <span class="string">'T'</span>, <span class="string">'B'</span>, <span class="string">'M'</span>, <span class="string">'k'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>small numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> unsignedNumber &lt; <span class="number">1000</span>
        <span class="keyword">if</span> decimals &gt; <span class="number">0</span>
            unsignedNumberString += <span class="string">".<span class="subst">#{ Array(decimals + <span class="number">1</span>).join('<span class="number">0</span>') }</span>"</span>
        <span class="keyword">return</span> <span class="string">"<span class="subst">#{ signString }</span><span class="subst">#{ unsignedNumberString }</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>really big numbers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">if</span> numberLength &gt; numberLengths[<span class="number">0</span>] + <span class="number">3</span>
        <span class="keyword">return</span> number.toExponential(decimals).replace(<span class="string">'e+'</span>, <span class="string">'x10^'</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>999 &lt; unsignedNumber &lt; 999,999,999,999,999</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">for</span> _length <span class="keyword">in</span> numberLengths
        <span class="keyword">if</span> numberLength &gt;= _length
            length = _length
            <span class="keyword">break</span>

    decimalIndex = numberLength - length + <span class="number">1</span>
    unsignedNumberCharacterArray = unsignedNumberString.split(<span class="string">""</span>)

    wholePartArray = unsignedNumberCharacterArray.slice(<span class="number">0</span>, decimalIndex)
    decimalPartArray = unsignedNumberCharacterArray.slice(decimalIndex, decimalIndex + decimals + <span class="number">1</span>)

    wholePart = wholePartArray.join(<span class="string">""</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>pad decimalPart if necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    decimalPart = decimalPartArray.join(<span class="string">""</span>)
    <span class="keyword">if</span> decimalPart.length &lt; decimals
        decimalPart += <span class="string">"<span class="subst">#{ Array(decimals - decimalPart.length + <span class="number">1</span>).join('<span class="number">0</span>') }</span>"</span>

    <span class="keyword">if</span> decimals <span class="keyword">is</span> <span class="number">0</span>
        output = <span class="string">"<span class="subst">#{ signString }</span><span class="subst">#{ wholePart }</span><span class="subst">#{ bigNumPrefixes[numberLengths.indexOf(length)] }</span>"</span>
    <span class="keyword">else</span>
        outputNumber = (+(<span class="string">"<span class="subst">#{ wholePart }</span>.<span class="subst">#{ decimalPart }</span>"</span>)).toFixed(decimals)
        output = <span class="string">"<span class="subst">#{ signString }</span><span class="subst">#{ outputNumber }</span><span class="subst">#{ bigNumPrefixes[numberLengths.indexOf(length)] }</span>"</span>

    output</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Converts an integer to a string containing commas every three digits.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.intcomma = Humanize.<span class="function"><span class="title">intComma</span></span> = (number, decimals=<span class="number">0</span>) -&gt; Humanize.formatNumber number, decimals</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Formats the value like a &#39;human-readable&#39; file size (i.e. &#39;13 KB&#39;, &#39;4.1 MB&#39;, &#39;102 bytes&#39;, etc).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.filesize = Humanize.<span class="function"><span class="title">fileSize</span></span> = (filesize) -&gt;
    <span class="keyword">if</span> filesize &gt;= <span class="number">1073741824</span>
        sizeStr = Humanize.formatNumber(filesize / <span class="number">1073741824</span>, <span class="number">2</span>, <span class="string">""</span>) + <span class="string">" GB"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> filesize &gt;= <span class="number">1048576</span>
        sizeStr = Humanize.formatNumber(filesize / <span class="number">1048576</span>, <span class="number">2</span>, <span class="string">""</span>) + <span class="string">" MB"</span>
    <span class="keyword">else</span> <span class="keyword">if</span> filesize &gt;= <span class="number">1024</span>
        sizeStr = Humanize.formatNumber(filesize / <span class="number">1024</span>, <span class="number">0</span>) + <span class="string">" KB"</span>
    <span class="keyword">else</span>
        sizeStr = Humanize.formatNumber(filesize, <span class="number">0</span>) + Humanize.pluralize filesize, <span class="string">" byte"</span>

    sizeStr</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Formats a number to a human-readable string.
Localize by overriding the precision, thousand and decimal arguments.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">formatNumber</span></span> = (number, precision=<span class="number">0</span>, thousand=<span class="string">","</span>, decimal=<span class="string">"."</span>) -&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Create some private utility functions to make the computational
code that follows much easier to read.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="function"><span class="title">firstComma</span></span> = (number, thousand, position) -&gt;
        <span class="keyword">if</span> position <span class="keyword">then</span> number.substr(<span class="number">0</span>, position) + thousand <span class="keyword">else</span> <span class="string">""</span>

    <span class="function"><span class="title">commas</span></span> = (number, thousand, position) -&gt;
        number.substr(position).replace <span class="regexp">/(\d{3})(?=\d)/g</span>, <span class="string">"$1"</span> + thousand

    <span class="function"><span class="title">decimals</span></span> = (number, decimal, usePrecision) =&gt;
        <span class="keyword">if</span> usePrecision <span class="keyword">then</span> decimal + Humanize.toFixed(Math.abs(number), usePrecision).split(<span class="string">"."</span>)[<span class="number">1</span>] <span class="keyword">else</span> <span class="string">""</span>

    usePrecision = Humanize.normalizePrecision precision</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Do some calc</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    negative = number &lt; <span class="number">0</span> <span class="keyword">and</span> <span class="string">"-"</span> <span class="keyword">or</span> <span class="string">""</span>
    base = parseInt(Humanize.toFixed(Math.abs(number <span class="keyword">or</span> <span class="number">0</span>), usePrecision), <span class="number">10</span>) + <span class="string">""</span>
    mod = <span class="keyword">if</span> base.length &gt; <span class="number">3</span> <span class="keyword">then</span> base.length % <span class="number">3</span> <span class="keyword">else</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Format the number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    negative +
    firstComma(base, thousand, mod) +
    commas(base, thousand, mod) +
    decimals(number, decimal, usePrecision)</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Fixes binary rounding issues (eg. (0.615).toFixed(2) === &quot;0.61&quot;)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">toFixed</span></span> = (value, precision) -&gt;
    precision ?= Humanize.normalizePrecision precision, <span class="number">0</span>
    power = Math.pow <span class="number">10</span>, precision</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Multiply up by precision, round accurately, then divide and use native toFixed()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    (Math.round(value * power) / power).toFixed precision</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Ensures precision value is a positive integer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">normalizePrecision</span></span> = (value, base) -&gt;
    value = Math.round Math.abs value
    <span class="keyword">if</span> isNaN(value) <span class="keyword">then</span> base <span class="keyword">else</span> value</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Converts an integer to its ordinal as a string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">ordinal</span></span> = (value) -&gt;
    number = parseInt value, <span class="number">10</span>

    <span class="keyword">return</span> value <span class="keyword">if</span> number <span class="keyword">is</span> <span class="number">0</span>

    specialCase = number % <span class="number">100</span>
    <span class="keyword">return</span> <span class="string">"<span class="subst">#{ number }</span>th"</span> <span class="keyword">if</span> specialCase <span class="keyword">in</span> [<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>]

    leastSignificant = number % <span class="number">10</span>
    <span class="keyword">switch</span> leastSignificant
        <span class="keyword">when</span> <span class="number">1</span>
            end = <span class="string">"st"</span>
        <span class="keyword">when</span> <span class="number">2</span>
            end = <span class="string">"nd"</span>
        <span class="keyword">when</span> <span class="number">3</span>
            end = <span class="string">"rd"</span>
        <span class="keyword">else</span>
            end = <span class="string">"th"</span>

    <span class="string">"<span class="subst">#{ number }</span><span class="subst">#{ end }</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Interprets numbers as occurences. Also accepts an optional array/map of overrides.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">times</span></span> = (value, overrides={}) -&gt;
    <span class="keyword">if</span> isFinite(value) <span class="keyword">and</span> value &gt;= <span class="number">0</span>
        number = parseFloat value
        smallTimes = [<span class="string">'never'</span>, <span class="string">'once'</span>, <span class="string">'twice'</span>]
        <span class="keyword">if</span> overrides[number]?
            <span class="string">"<span class="subst">#{overrides[number]}</span>"</span>
        <span class="keyword">else</span>
            <span class="string">"<span class="subst">#{smallTimes[number]?.toString() <span class="keyword">or</span> number.toString() + ' times'}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Returns the plural version of a given word if the value is not 1. The default suffix is &#39;s&#39;.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">pluralize</span></span> = (number, singular, plural) -&gt;
    <span class="keyword">return</span> <span class="keyword">unless</span> number? <span class="keyword">and</span> singular?

    plural ?= singular + <span class="string">"s"</span>

    <span class="keyword">if</span> parseInt(number, <span class="number">10</span>) <span class="keyword">is</span> <span class="number">1</span> <span class="keyword">then</span> singular <span class="keyword">else</span> plural</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Truncates a string if it is longer than the specified number of characters (inclusive). Truncated strings will end with a translatable ellipsis sequence (&quot;…&quot;).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">truncate</span></span> = (str, length=<span class="number">100</span>, ending=<span class="string">'...'</span>) -&gt;
    <span class="keyword">if</span> str.length &gt; length
        str.substring(<span class="number">0</span>, length - ending.length) + ending
    <span class="keyword">else</span>
        str</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Truncates a string after a certain number of words.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.truncatewords = Humanize.<span class="function"><span class="title">truncateWords</span></span> = (string, length) -&gt;
    array = string.split <span class="string">" "</span>
    result = <span class="string">""</span>
    i = <span class="number">0</span>

    <span class="keyword">while</span> i &lt; length
        <span class="keyword">if</span> array[i]?
            result += <span class="string">"<span class="subst">#{array[i]}</span> "</span>
        i++

    result += <span class="string">"..."</span> <span class="keyword">if</span> array.length &gt; length</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Truncates a number to an upper bound.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.truncatenumber = Humanize.<span class="function"><span class="title">boundedNumber</span></span> = (num, bound=<span class="number">100</span>, ending=<span class="string">"+"</span>) -&gt;
    result = <span class="literal">null</span>

    <span class="keyword">if</span> isFinite(num) <span class="keyword">and</span> isFinite(bound)
        result = bound + ending <span class="keyword">if</span> num &gt; bound

    (result <span class="keyword">or</span> num).toString()</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Converts a list of items to a human readable string with an optional limit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">oxford</span></span> = (items, limit, limitStr) -&gt;
    numItems = items.length

    <span class="keyword">if</span> numItems &lt; <span class="number">2</span>
        <span class="keyword">return</span> <span class="string">"<span class="subst">#{items}</span>"</span>

    <span class="keyword">else</span> <span class="keyword">if</span> numItems <span class="keyword">is</span> <span class="number">2</span>
        <span class="keyword">return</span> items.join <span class="string">' and '</span>

    <span class="keyword">else</span> <span class="keyword">if</span> limit? <span class="keyword">and</span> numItems &gt; limit
        extra = numItems - limit
        limitIndex = limit
        limitStr ?= <span class="string">", and <span class="subst">#{extra}</span> <span class="subst">#{Humanize.pluralize(extra, 'other')}</span>"</span>

    <span class="keyword">else</span>
        limitIndex = -<span class="number">1</span>
        limitStr = <span class="string">", and <span class="subst">#{items[numItems - <span class="number">1</span>]}</span>"</span>

    items.slice(<span class="number">0</span>, limitIndex).join(<span class="string">', '</span>) + limitStr</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Converts an object to a definition-like string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">dictionary</span></span> = (object, joiner=<span class="string">' is '</span>, separator=<span class="string">', '</span>) -&gt;
    result = <span class="string">''</span>

    <span class="keyword">if</span> object? <span class="keyword">and</span> <span class="keyword">typeof</span> object <span class="keyword">is</span> <span class="string">'object'</span> <span class="keyword">and</span> Object.prototype.toString.call(object) <span class="keyword">isnt</span> <span class="string">'[object Array]'</span>
        defs = []
        <span class="keyword">for</span> key, val <span class="keyword">of</span> object
            defs.push <span class="string">"<span class="subst">#{ key }</span><span class="subst">#{ joiner }</span><span class="subst">#{ val }</span>"</span>

        result = defs.join separator

    result</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Describes how many times an item appears in a list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">frequency</span></span> = (list, verb) -&gt;
    <span class="keyword">return</span> <span class="keyword">unless</span> isArray(list)

    len = list.length
    times = Humanize.times len

    <span class="keyword">if</span> len <span class="keyword">is</span> <span class="number">0</span>
        str = <span class="string">"<span class="subst">#{times}</span> <span class="subst">#{verb}</span>"</span>
    <span class="keyword">else</span>
        str = <span class="string">"<span class="subst">#{verb}</span> <span class="subst">#{times}</span>"</span>

    str

Humanize.<span class="function"><span class="title">pace</span></span> = (value, intervalMs, unit=<span class="string">'time'</span>) -&gt;
    <span class="keyword">if</span> value <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">or</span> intervalMs <span class="keyword">is</span> <span class="number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Needs a better string than this...</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> <span class="string">"No <span class="subst">#{Humanize.pluralize(unit)}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Expose these as overridables?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    prefix = <span class="string">'Approximately'</span>
    timeUnit = <span class="literal">null</span>

    rate = value / intervalMs
    <span class="keyword">for</span> f <span class="keyword">in</span> timeFormats  <span class="comment"># assumes sorted list</span>
        relativePace = rate * f.value
        <span class="keyword">if</span> relativePace &gt; <span class="number">1</span>
            timeUnit = f.name
            <span class="keyword">break</span></pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Use the last time unit if there is nothing smaller</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">unless</span> timeUnit
        prefix = <span class="string">'Less than'</span>
        relativePace = <span class="number">1</span>
        timeUnit = timeFormats[timeFormats.length - <span class="number">1</span>].name

    roundedPace = Math.round relativePace
    unit = Humanize.pluralize roundedPace, unit

    <span class="string">"<span class="subst">#{prefix}</span> <span class="subst">#{roundedPace}</span> <span class="subst">#{unit}</span> per <span class="subst">#{timeUnit}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Converts newlines to <br/> tags</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">nl2br</span></span> = (string, replacement=<span class="string">'&lt;br/&gt;'</span>) -&gt;
    string.replace <span class="regexp">/\n/g</span>, replacement</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Converts <br/> tags to newlines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">br2nl</span></span> = (string, replacement=<span class="string">'\r\n'</span>) -&gt;
    string.replace <span class="regexp">/\&lt;br\s*\/?\&gt;/g</span>, replacement</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Capitalizes first letter in a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">capitalize</span></span> = (string, downCaseTail=<span class="literal">false</span>) -&gt;
    <span class="string">"<span class="subst">#{ string.charAt(<span class="number">0</span>).toUpperCase() }</span><span class="subst">#{ <span class="keyword">if</span> downCaseTail <span class="keyword">then</span> string.slice(<span class="number">1</span>).toLowerCase() <span class="keyword">else</span> string.slice(<span class="number">1</span>) }</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Capitalizes the first letter of each word in a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.<span class="function"><span class="title">capitalizeAll</span></span> = (string) -&gt;
    string.replace <span class="regexp">/(?:^|\s)\S/g</span>, (a) -&gt; a.toUpperCase()</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Titlecase words in a string.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>Humanize.titlecase = Humanize.<span class="function"><span class="title">titleCase</span></span> = (string) -&gt;
    smallWords = <span class="regexp">/\b(a|an|and|at|but|by|de|en|for|if|in|of|on|or|the|to|via|vs?\.?)\b/i</span>
    internalCaps = <span class="regexp">/\S+[A-Z]+\S*/</span>
    splitOnWhiteSpaceRegex = <span class="regexp">/\s+/</span>
    splitOnHyphensRegex = <span class="regexp">/-/</span>

    <span class="function"><span class="title">doTitleCase</span></span> = (_string, hyphenated=<span class="literal">false</span>, firstOrLast=<span class="literal">true</span>) =&gt;
        titleCasedArray = []
        stringArray = _string.split(<span class="keyword">if</span> hyphenated <span class="keyword">then</span> splitOnHyphensRegex <span class="keyword">else</span> splitOnWhiteSpaceRegex)
        <span class="keyword">for</span> word, index <span class="keyword">in</span> stringArray
            <span class="keyword">if</span> word.indexOf(<span class="string">'-'</span>) <span class="keyword">isnt</span> -<span class="number">1</span>
                titleCasedArray.push(doTitleCase(word, <span class="literal">true</span>, (index <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">or</span> index <span class="keyword">is</span> stringArray.length - <span class="number">1</span>)))
                <span class="keyword">continue</span>

            <span class="keyword">if</span> firstOrLast <span class="keyword">and</span> (index <span class="keyword">is</span> <span class="number">0</span> <span class="keyword">or</span> index <span class="keyword">is</span> stringArray.length - <span class="number">1</span>)
                titleCasedArray.push <span class="keyword">if</span> internalCaps.test(word) <span class="keyword">then</span> word <span class="keyword">else</span> Humanize.capitalize(word)
                <span class="keyword">continue</span>

            <span class="keyword">if</span> internalCaps.test(word)
                titleCasedArray.push(word)
            <span class="keyword">else</span> <span class="keyword">if</span> smallWords.test(word)
                titleCasedArray.push(word.toLowerCase())
            <span class="keyword">else</span>
                titleCasedArray.push(Humanize.capitalize(word))

        titleCasedArray.join(<span class="keyword">if</span> hyphenated <span class="keyword">then</span> <span class="string">'-'</span> <span class="keyword">else</span> <span class="string">' '</span>)
    doTitleCase(string)

<span class="property">@Humanize</span> = Humanize
module?.exports = Humanize</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
